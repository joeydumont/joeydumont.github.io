---
layout: post
title: Fortran, C++ and qmake
date: '2012-08-24T13:20:00.000-04:00'
author: jayd
tags:
- c++
- programming
- fortran
- linux
- numerical_physics
- physics
modified_time: '2013-04-10T08:30:28.370-04:00'
blogger_id: tag:blogger.com,1999:blog-3428773921792525741.post-4429777278763678793
blogger_orig_url: http://blog.joey-dumont.ca/2012/08/fortran-c-and-qmake.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://upload.wikimedia.org/wikipedia/ru/7/70/QtCreator.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img alt="" border="0" height="196" src="http://upload.wikimedia.org/wikipedia/ru/7/70/QtCreator.png" title="I know, I know, using an IDE on Linux..." width="200" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Qt Creator Logo</td></tr></tbody></table><div style="text-align: justify;">&nbsp; &nbsp;Call me a noob, but I love using Qt Creator even when I'm not programming a GUI. The UI greatly facilitates code writing: the syntax highlighting is very customizable, it shows you the methods of a class when you use the . or <span style="font-family: Courier New, Courier, monospace;">-&gt;</span> operators, it makes the build process faster and easier to configure (sometimes), etc.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">&nbsp; &nbsp;Now, I didn't want to make this a post about Qt Creator, so here comes the meat. I've been trying to add Fortran code to my numerical library, something I think is pretty common in scientific circles. Of course, that's been <a href="http://www.yolinux.com/TUTORIALS/LinuxTutorialMixingFortranAndC.html" target="_blank">done</a> <a href="http://stackoverflow.com/questions/5663083/linking-fortran-and-c-binaries-using-gcc" target="_blank">before</a>, but my research has yielded one <a href="http://nanophysics.dk/blog/2009/03/25/getting-started-with-qt-linked-with-fortran/" target="_blank">link</a> for Fortran and Qt.&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">&nbsp; &nbsp;I'm using <a href="http://dl.acm.org/citation.cfm?id=214331" target="_blank">D.E. Amos'</a>&nbsp;Fortran code to compute Bessel and Hankel functions of complex arguments and all (real) orders (we use identities to convert the negative order computations to positive order ones). Complex orders are not supported. Work by <a href="http://www.springerlink.com/content/n2j129r7l0532h72/" target="_blank">Temme</a>&nbsp;could be used for this, but maybe a later time.&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">&nbsp; &nbsp;I have two Fortran source files that must be incorporated into a C++ numerical library. Using <span style="font-family: Courier New, Courier, monospace;">qmake</span>, this is child's play.&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"></div><ul><li>First, add the Fortran source files as sources in your .pro file.&nbsp;</li><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">SOURCES += machine.for zbesh.for</span></blockquote><br />Those are the names of the Fortran sources files used by Amos.&nbsp;&nbsp;</ul><ul><li>Second, create a C++ header file that links to the Fortran subroutines inside the source files.&nbsp; <br /><script src="https://gist.github.com/3452963.js"></script><br />A couple things about this linkage. Notice that I appended a _ to the Fortran subroutine names. The <span style="font-family: Courier New, Courier, monospace;">extern</span> keyword tells the compiler that a separately compiled <i>object</i> will be used. By defaul<span style="font-family: Courier New, Courier, monospace;">t, g++ </span> will append _ to Fortran subroutines when creating an object file. This means that if you change this compiler setting, be sure to remember to change your function declarations in your C++ header file.<br />Also, the functions take pointers to variables. In Fortran, all functions take their arguments by reference. It is thus necessary to use pointers when using Fortran subroutines in C++.&nbsp;</li><li>You're done! You can now use your Fortran subroutines in your C++ program! Just don't forget to add the <blockquote class="tr_bq" style="text-align: left;"><span style="font-family: Courier New, Courier, monospace;">-lgfortran</span></blockquote>when compiling either the program you are writing or a program that uses a library that uses Fortran subroutines.  </li></ul><br />Wow, that last sentence was terrible.<br /><br /><span style="text-align: justify;">&nbsp; &nbsp;Anyway, have fun programming!</span></div>